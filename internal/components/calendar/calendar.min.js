(()=>{(function(){function w(e){if(!e||e.hasAttribute("data-initialized"))return;e.setAttribute("data-initialized","true");let p=e.querySelector("[data-calendar-month-display]"),I=e.querySelector("[data-calendar-weekdays]"),y=e.querySelector("[data-calendar-days]"),b=e.querySelector("[data-calendar-prev]"),M=e.querySelector("[data-calendar-next]"),U=e.closest("[data-calendar-wrapper]"),f=U?U.querySelector("[data-calendar-hidden-input]"):null;if(!p||!I||!y||!b||!M||!f){console.error("Calendar init error: Missing required elements (or hidden input relative to wrapper).",e);return}let D=e.dataset.localeTag||"en-US",T;try{T=Array.from({length:12},(t,n)=>new Intl.DateTimeFormat(D,{month:"long",timeZone:"UTC"}).format(new Date(Date.UTC(2e3,n,1))))}catch(t){console.error(`Calendar: Error generating month names via Intl (locale: "${D}"). Falling back to English.`,t),T=["January","February","March","April","May","June","July","August","September","October","November","December"]}let S=["Su","Mo","Tu","We","Th","Fr","Sa"];try{S=Array.from({length:7},(t,n)=>new Intl.DateTimeFormat(D,{weekday:"short"}).format(new Date(Date.UTC(2e3,0,n))))}catch(t){console.error("Error generating calendar day names via Intl:",t)}let i=parseInt(e.dataset.initialMonth),c=parseInt(e.dataset.initialYear),u=null;e.dataset.selectedDate&&(u=B(e.dataset.selectedDate));function B(t){if(!t)return null;try{let n=t.split("-"),s=parseInt(n[0],10),l=parseInt(n[1],10)-1,a=parseInt(n[2],10),d=new Date(Date.UTC(s,l,a));if(!isNaN(d)&&d.getUTCFullYear()===s&&d.getUTCMonth()===l&&d.getUTCDate()===a)return d}catch{}return null}function v(){let t=Math.max(0,Math.min(11,i)),s=`${T[t]} ${c}`;p.textContent=s}function k(){I.innerHTML="",S.forEach(t=>{let n=document.createElement("div");n.className="text-center text-xs text-muted-foreground font-medium",n.textContent=t,I.appendChild(n)})}function g(){y.innerHTML="";let s=new Date(Date.UTC(c,i,1)).getUTCDay(),l=new Date(Date.UTC(c,i+1,0)).getUTCDate(),a=new Date,d=new Date(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate()));for(let r=0;r<s;r++){let o=document.createElement("div");o.className="h-8 w-8",y.appendChild(o)}for(let r=1;r<=l;r++){let o=document.createElement("button");o.type="button",o.className="inline-flex h-8 w-8 items-center justify-center rounded-md text-sm font-medium focus:outline-none focus:ring-1 focus:ring-ring",o.textContent=r,o.dataset.day=r;let h=new Date(Date.UTC(c,i,r)),O=u&&h.getTime()===u.getTime(),H=h.getTime()===d.getTime();O?o.classList.add("bg-primary","text-primary-foreground","hover:bg-primary/90"):H?o.classList.add("bg-accent","text-accent-foreground"):o.classList.add("hover:bg-accent","hover:text-accent-foreground"),o.addEventListener("click",q),y.appendChild(o)}}function F(){i--,i<0&&(i=11,c--),v(),g()}function L(){i++,i>11&&(i=0,c++),v(),g()}let m=e.hasAttribute("data-with-time"),x=e.hasAttribute("data-with-seconds"),C=e.hasAttribute("data-with-24hours")?e.getAttribute("data-with-24hours")!=="false":!0;function N(t){if(!m||!t)return;let n=document.getElementById(e.id+"-hour"),s=document.getElementById(e.id+"-minute"),l=document.getElementById(e.id+"-second"),a=document.getElementById(e.id+"-ampm"),d=t.getUTCHours(),r=t.getUTCMinutes(),o=t.getUTCSeconds();!C&&a&&(d===0?(d=12,a.value="AM"):d>12?(a.value="PM",d=d-12):d===12?a.value="PM":a.value="AM"),n&&(n.value=d),s&&(s.value=r),l&&x&&(l.value=o)}function A(){if(!m)return{hour:0,minute:0,second:0};let t=document.getElementById(e.id+"-hour"),n=document.getElementById(e.id+"-minute"),s=document.getElementById(e.id+"-second"),l=document.getElementById(e.id+"-ampm"),a=t?parseInt(t.value,10):C?0:12,d=n?parseInt(n.value,10):0,r=s&&x?parseInt(s.value,10):0;return!C&&l&&(l.value==="PM"&&a<12&&(a+=12),l.value==="AM"&&a===12&&(a=0)),{hour:a,minute:d,second:r}}function q(t){let n=parseInt(t.target.dataset.day);if(!n)return;let s=new Date(Date.UTC(c,i,n)),{hour:l,minute:a,second:d}=A();s.setUTCHours(l,a,d),u=s;let r=s.toISOString();m||(r=r.split("T")[0]),f.value=r,f.dispatchEvent(new Event("change",{bubbles:!0})),e.dispatchEvent(new CustomEvent("calendar-date-selected",{bubbles:!0,detail:{date:s}})),g()}if(m&&u&&setTimeout(()=>N(u),0),b.addEventListener("click",F),M.addEventListener("click",L),v(),k(),g(),m){let t=document.getElementById(e.id+"-hour"),n=document.getElementById(e.id+"-minute"),s=document.getElementById(e.id+"-second"),l=document.getElementById(e.id+"-ampm");[t,n,s,l].forEach(function(a){a&&a.addEventListener("change",function(){if(!u)return;let{hour:d,minute:r,second:o}=A();u.setUTCHours(d,r,o);let h=u.toISOString();m||(h=h.split("T")[0]),f.value=h,f.dispatchEvent(new Event("change",{bubbles:!0})),e.dispatchEvent(new CustomEvent("calendar-date-selected",{bubbles:!0,detail:{date:u}}))})})}e._calendarInitialized=!0}function E(e=document){e instanceof Element&&e.matches("[data-calendar-container]")&&w(e);for(let p of e.querySelectorAll("[data-calendar-container]:not([data-initialized])"))w(p)}window.templUI=window.templUI||{},window.templUI.calendar={init:E},document.addEventListener("DOMContentLoaded",()=>E())})();})();
