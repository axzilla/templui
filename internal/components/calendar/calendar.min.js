(()=>{(function(){function T(e){let c=e.hasAttribute("data-with-time"),C=e.hasAttribute("data-with-seconds"),y=e.hasAttribute("data-with-24hours")?e.getAttribute("data-with-24hours")!=="false":!0;if(!e||e.hasAttribute("data-initialized"))return;e.setAttribute("data-initialized","true");let b=e.querySelector("[data-calendar-month-display]"),I=e.querySelector("[data-calendar-weekdays]"),p=e.querySelector("[data-calendar-days]"),M=e.querySelector("[data-calendar-prev]"),S=e.querySelector("[data-calendar-next]"),U=e.closest("[data-calendar-wrapper]"),f=U?U.querySelector("[data-calendar-hidden-input]"):null;if(!b||!I||!p||!M||!S||!f){console.error("Calendar init error: Missing required elements (or hidden input relative to wrapper).",e);return}let D=e.dataset.localeTag||"en-US",v;try{v=Array.from({length:12},(t,n)=>new Intl.DateTimeFormat(D,{month:"long",timeZone:"UTC"}).format(new Date(Date.UTC(2e3,n,1))))}catch(t){console.error(`Calendar: Error generating month names via Intl (locale: "${D}"). Falling back to English.`,t),v=["January","February","March","April","May","June","July","August","September","October","November","December"]}let x=["Su","Mo","Tu","We","Th","Fr","Sa"];try{x=Array.from({length:7},(t,n)=>new Intl.DateTimeFormat(D,{weekday:"short"}).format(new Date(Date.UTC(2e3,0,n))))}catch(t){console.error("Error generating calendar day names via Intl:",t)}let u=parseInt(e.dataset.initialMonth),m=parseInt(e.dataset.initialYear),i=null;e.dataset.selectedDate&&(i=N(e.dataset.selectedDate),c&&i&&setTimeout(()=>A(i),0),i&&(u=i.getMonth(),m=i.getFullYear()));function N(t){if(!t)return null;if(/([zZ]|[+-]\d{2}:?\d{2})$/.test(t)){let n=new Date(t);if(!isNaN(n.getTime()))return n}try{let n=t.split("-"),d=parseInt(n[0],10),l=parseInt(n[1],10)-1,a=parseInt(n[2],10),r=new Date(Date.UTC(d,l,a));if(!isNaN(r)&&r.getUTCFullYear()===d&&r.getUTCMonth()===l&&r.getUTCDate()===a)return r}catch{}return null}function w(){let t=Math.max(0,Math.min(11,u)),d=`${v[t]} ${m}`;b.textContent=d}function k(){I.innerHTML="",x.forEach(t=>{let n=document.createElement("div");n.className="text-center text-xs text-muted-foreground font-medium",n.textContent=t,I.appendChild(n)})}function g(){p.innerHTML="";let d=new Date(Date.UTC(m,u,1)).getUTCDay(),l=new Date(Date.UTC(m,u+1,0)).getUTCDate(),a=new Date,r=new Date(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate()));for(let s=0;s<d;s++){let o=document.createElement("div");o.className="h-8 w-8",p.appendChild(o)}for(let s=1;s<=l;s++){let o=document.createElement("button");o.type="button",o.className="inline-flex h-8 w-8 items-center justify-center rounded-md text-sm font-medium focus:outline-none focus:ring-1 focus:ring-ring",o.textContent=s,o.dataset.day=s;let h=new Date(Date.UTC(m,u,s)),O=i&&h.getTime()===i.getTime(),H=h.getTime()===r.getTime();O?o.classList.add("bg-primary","text-primary-foreground","hover:bg-primary/90"):H?o.classList.add("bg-accent","text-accent-foreground"):o.classList.add("hover:bg-accent","hover:text-accent-foreground"),o.addEventListener("click",q),p.appendChild(o)}}function F(){u--,u<0&&(u=11,m--),w(),g()}function L(){u++,u>11&&(u=0,m++),w(),g()}function A(t){if(!c||!t)return;let n=document.getElementById(e.id+"-hour"),d=document.getElementById(e.id+"-minute"),l=document.getElementById(e.id+"-second"),a=document.getElementById(e.id+"-ampm"),r=t.getHours(),s=t.getMinutes(),o=t.getSeconds();!y&&a&&(r===0?(r=12,a.value="AM"):r>12?(a.value="PM",r=r-12):r===12?a.value="PM":a.value="AM"),n&&(n.value=r.toString().padStart(2,"0")),d&&(d.value=s.toString().padStart(2,"0")),l&&C&&(l.value=o.toString().padStart(2,"0"))}function B(){if(!c)return{hour:0,minute:0,second:0};let t=document.getElementById(e.id+"-hour"),n=document.getElementById(e.id+"-minute"),d=document.getElementById(e.id+"-second"),l=document.getElementById(e.id+"-ampm"),a=t?parseInt(t.value,10):y?0:12,r=n?parseInt(n.value,10):0,s=d&&C?parseInt(d.value,10):0;return!y&&l&&(l.value==="PM"&&a<12&&(a+=12),l.value==="AM"&&a===12&&(a=0)),{hour:a,minute:r,second:s}}function q(t){let n=parseInt(t.target.dataset.day);if(!n)return;let d=new Date(m,u,n),{hour:l,minute:a,second:r}=B();d.setHours(l,a,r),i=d;let s=d.toISOString();c||(s=s.split("T")[0]),f.value=s,f.dispatchEvent(new Event("change",{bubbles:!0})),e.dispatchEvent(new CustomEvent("calendar-date-selected",{bubbles:!0,detail:{date:d,closePopover:!0}})),g()}if(c&&i&&setTimeout(()=>A(i),0),M.addEventListener("click",F),S.addEventListener("click",L),w(),k(),g(),c){let t=document.getElementById(e.id+"-hour"),n=document.getElementById(e.id+"-minute"),d=document.getElementById(e.id+"-second"),l=document.getElementById(e.id+"-ampm");[t,n,d,l].forEach(function(a){a&&a.addEventListener("change",function(){if(!i)return;let{hour:r,minute:s,second:o}=B();i.setHours(r,s,o);let h=i.toISOString();c||(h=h.split("T")[0]),f.value=h,f.dispatchEvent(new Event("change",{bubbles:!0})),e.dispatchEvent(new CustomEvent("calendar-date-selected",{bubbles:!0,detail:{date:i}}))})})}e._calendarInitialized=!0}function E(e=document){e instanceof Element&&e.matches("[data-calendar-container]")&&T(e);for(let c of e.querySelectorAll("[data-calendar-container]:not([data-initialized])"))T(c)}window.templUI=window.templUI||{},window.templUI.calendar={init:E},document.addEventListener("DOMContentLoaded",()=>E())})();})();
