(()=>{(function(){function U(e){if(!e||typeof e!="string")return null;let t=e.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!t)return null;let a=parseInt(t[1],10),r=parseInt(t[2],10)-1,l=parseInt(t[3],10),d=new Date(Date.UTC(a,r,l));return d.getUTCFullYear()===a&&d.getUTCMonth()===r&&d.getUTCDate()===l?d:null}function S(e){if(/([zZ]|[+-]\d{2}:?\d{2})$/.test(e)){let s=new Date(e);if(!isNaN(s.getTime()))return s}if(!e||typeof e!="string")return null;let t=e.match(/^([0-9]{4})-(\d{2})-(\d{2})(?:[T ](\d{2}):(\d{2})(?::(\d{2}))?)?/);if(!t)return null;let a=parseInt(t[1],10),r=parseInt(t[2],10)-1,l=parseInt(t[3],10),d=t[4]?parseInt(t[4],10):0,o=t[5]?parseInt(t[5],10):0,i=t[6]?parseInt(t[6],10):0,n=new Date(a,r,l,d,o,i);return n.getFullYear()===a&&n.getMonth()===r&&n.getDate()===l?n:null}function v(e,t,a){if(!e||isNaN(e.getTime()))return"";let r={};switch(t){case"locale-short":r.dateStyle="short";break;case"locale-long":r.dateStyle="long";break;case"locale-full":r.dateStyle="full";break;case"locale-medium":default:r.dateStyle="medium";break}try{return new Intl.DateTimeFormat(a,r).format(e)}catch(l){console.error(`Error formatting date with Intl (locale: ${a}, format: ${t}, timezone: UTC):`,l);try{let d={dateStyle:"medium",timeZone:"UTC"};return new Intl.DateTimeFormat(a,d).format(e)}catch(d){console.error(`Error formatting date with fallback Intl (locale: ${a}, timezone: UTC):`,d);let o=e.getUTCFullYear(),i=(e.getUTCMonth()+1).toString().padStart(2,"0"),n=e.getUTCDate().toString().padStart(2,"0");return`${o}-${i}-${n}`}}}function k(e,t,a,r,l,d){if(!e||isNaN(e.getTime()))return"";let o={};if(r){switch(t){case"locale-short":o.dateStyle="short",o.timeStyle=l?"medium":"short";break;case"locale-long":o.dateStyle="long",o.timeStyle=l?"medium":"short";break;case"locale-full":o.dateStyle="full",o.timeStyle=l?"medium":"short";break;case"locale-medium":default:o.dateStyle="medium",o.timeStyle=l?"medium":"short";break}o.hour12=!d}else switch(t){case"locale-short":o.dateStyle="short";break;case"locale-long":o.dateStyle="long";break;case"locale-full":o.dateStyle="full";break;case"locale-medium":default:o.dateStyle="medium";break}try{return new Intl.DateTimeFormat(a,o).format(e)}catch(i){console.error(`Error formatting date with Intl (locale: ${a}, format: ${t}, timezone: UTC):`,i);try{let n={dateStyle:"medium",timeZone:"UTC"};return new Intl.DateTimeFormat(a,n).format(e)}catch(n){console.error(`Error formatting date with fallback Intl (locale: ${a}, timezone: UTC):`,n);let s=e.getUTCFullYear(),p=(e.getUTCMonth()+1).toString().padStart(2,"0"),f=e.getUTCDate().toString().padStart(2,"0");return`${s}-${p}-${f}`}}}function T(e){if(!e)return"";let t=I=>I.toString().padStart(2,"0"),a=e.getFullYear(),r=t(e.getMonth()+1),l=t(e.getDate()),d=t(e.getHours()),o=t(e.getMinutes()),i=t(e.getSeconds()),n=e.getMilliseconds().toString().padStart(3,"0"),s=-e.getTimezoneOffset(),p=s>=0?"+":"-",f=Math.abs(s),h=t(Math.floor(f/60)),y=t(f%60);return`${a}-${r}-${l}T${d}:${o}:${i}.${n}${p}${h}:${y}`}function w(e){if(!e||e.hasAttribute("data-initialized"))return;e.setAttribute("data-initialized","true");let t=e.id,a=e.querySelector("[data-datepicker-display]"),r=t+"-calendar-instance",l=document.getElementById(r),d=r+"-hidden",o=document.getElementById(d),i=l,n=o;if(!l||!o){let c=e.getAttribute("aria-controls"),u=c?document.getElementById(c):null;if(u&&(i||(i=u.querySelector("[data-calendar-container]")),!n)){let m=u.querySelector("[data-calendar-wrapper]");n=m?m.querySelector("[data-calendar-hidden-input]"):null}}if(!a||!i||!n){console.error("DatePicker init error: Missing required elements.",{datePickerID:t,displaySpan:a,calendar:i,hiddenInput:n});return}let s=e.dataset.displayFormat||"locale-medium",p=e.dataset.localeTag||"en-US",f=e.dataset.placeholder||"Select a date",h=e.dataset.withTime==="true",y=e.dataset.withSeconds==="true",I=e.dataset.with24Hours!=="false",C=c=>{if(!c.detail||!c.detail.date||!(c.detail.date instanceof Date))return;let u=c.detail.date,m=k(u,s,p,h,y,I);a.textContent=m,a.classList.remove("text-muted-foreground");let $=document.getElementById(e.id+"-form-hidden");if($&&($.value=T(u)),c.detail.closePopover){let E=e.closest("[data-popover]")?.querySelector("[data-popover-trigger]");E instanceof HTMLElement?E.click():e.click()}},D=()=>{if(n&&n.value){let c=S(n.value);if(c){let m=k(c,s,p,h,y,I);a.textContent.trim()!==m&&(a.textContent=m,a.classList.remove("text-muted-foreground"))}else a.textContent=f,a.classList.add("text-muted-foreground");let u=document.getElementById(e.id+"-form-hidden");if(u){let m=S(n.value);u.value=m?T(m):""}}else{a.textContent=f,a.classList.add("text-muted-foreground");let c=document.getElementById(e.id+"-form-hidden");c&&(c.value="")}};if(i.addEventListener("calendar-date-selected",C),n){n.addEventListener("change",D);let c=document.getElementById(e.id+"-form-hidden");c&&n.addEventListener("change",function(){c.value=n.value})}D(),e._datePickerInitialized=!0,e._datePickerCleanup=()=>{i&&i.removeEventListener("calendar-date-selected",C)},h?e.setAttribute("data-with-time","true"):e.removeAttribute("data-with-time")}function b(e=document){e instanceof Element&&e.matches('[data-datepicker="true"]')&&w(e),e.querySelectorAll('[data-datepicker="true"]:not([data-initialized])').forEach(t=>{w(t)})}window.templUI=window.templUI||{},window.templUI.datePicker={init:b},document.addEventListener("DOMContentLoaded",()=>b())})();})();
