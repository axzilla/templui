(()=>{(function(){function q(e){if(!e||typeof e!="string")return null;let t=e.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!t)return null;let a=parseInt(t[1],10),n=parseInt(t[2],10)-1,d=parseInt(t[3],10),o=new Date(Date.UTC(a,n,d));return o.getUTCFullYear()===a&&o.getUTCMonth()===n&&o.getUTCDate()===d?o:null}function F(e){if(!e||typeof e!="string")return null;let t=e.match(/^(\d{4})-(\d{2})-(\d{2})(?:[T ](\d{2}):(\d{2})(?::(\d{2}))?)?/);if(!t)return null;let a=parseInt(t[1],10),n=parseInt(t[2],10)-1,d=parseInt(t[3],10),o=t[4]?parseInt(t[4],10):0,l=t[5]?parseInt(t[5],10):0,c=t[6]?parseInt(t[6],10):0,r=new Date(Date.UTC(a,n,d,o,l,c));return r.getUTCFullYear()===a&&r.getUTCMonth()===n&&r.getUTCDate()===d?r:null}function A(e,t,a){if(!e||isNaN(e.getTime()))return"";let n={timeZone:"UTC"};switch(t){case"locale-short":n.dateStyle="short";break;case"locale-long":n.dateStyle="long";break;case"locale-full":n.dateStyle="full";break;case"locale-medium":default:n.dateStyle="medium";break}try{return new Intl.DateTimeFormat(a,n).format(e)}catch(d){console.error(`Error formatting date with Intl (locale: ${a}, format: ${t}, timezone: UTC):`,d);try{let o={dateStyle:"medium",timeZone:"UTC"};return new Intl.DateTimeFormat(a,o).format(e)}catch(o){console.error(`Error formatting date with fallback Intl (locale: ${a}, timezone: UTC):`,o);let l=e.getUTCFullYear(),c=(e.getUTCMonth()+1).toString().padStart(2,"0"),r=e.getUTCDate().toString().padStart(2,"0");return`${l}-${c}-${r}`}}}function h(e,t,a,n,d,o){if(!e||isNaN(e.getTime()))return"";let l={timeZone:"UTC"};switch(t){case"locale-short":l.dateStyle="short";break;case"locale-long":l.dateStyle="long";break;case"locale-full":l.dateStyle="full";break;case"locale-medium":default:l.dateStyle="medium";break}n&&(l.hour="2-digit",l.minute="2-digit",d&&(l.second="2-digit"),l.hour12=!o);try{return new Intl.DateTimeFormat(a,l).format(e)}catch{return e.toISOString()}}function y(e){if(!e||e.hasAttribute("data-initialized"))return;e.setAttribute("data-initialized","true");let t=e.id,a=e.querySelector("[data-datepicker-display]"),n=t+"-calendar-instance",d=document.getElementById(n),o=n+"-hidden",l=document.getElementById(o),c=d,r=l;if(!d||!l){let i=e.getAttribute("aria-controls"),s=i?document.getElementById(i):null;if(s&&(c||(c=s.querySelector("[data-calendar-container]")),!r)){let f=s.querySelector("[data-calendar-wrapper]");r=f?f.querySelector("[data-calendar-hidden-input]"):null}}if(!a||!c||!r){console.error("DatePicker init error: Missing required elements.",{datePickerID:t,displaySpan:a,calendar:c,hiddenInput:r});return}let C=e.dataset.displayFormat||"locale-medium",S=e.dataset.localeTag||"en-US",w=e.dataset.placeholder||"Select a date",m=e.dataset.withTime==="true",k=e.dataset.withSeconds==="true",p=e.dataset.with24Hours!=="false",D=i=>{if(!i.detail||!i.detail.date||!(i.detail.date instanceof Date))return;let s=i.detail.date;if(m){let b=document.getElementById(e.id+"-hour"),v=document.getElementById(e.id+"-minute"),E=document.getElementById(e.id+"-second"),I=document.getElementById(e.id+"-ampm"),u=b?parseInt(b.value,10):p?0:12,L=v?parseInt(v.value,10):0,M=E?parseInt(E.value,10):0;!p&&I&&(I.value==="PM"&&u<12&&(u+=12),I.value==="AM"&&u===12&&(u=0)),s.setUTCHours(u,L,M)}let f=h(s,C,S,m,k,p);a.textContent=f,a.classList.remove("text-muted-foreground");let U=e.closest("[data-popover]")?.querySelector("[data-popover-trigger]");U instanceof HTMLElement?U.click():e.click()},x=()=>{if(r&&r.value){let i=F(r.value);if(i){let s=h(i,C,S,m,k,p);a.textContent.trim()!==s&&(a.textContent=s,a.classList.remove("text-muted-foreground"))}else a.textContent=w,a.classList.add("text-muted-foreground")}else a.textContent=w,a.classList.add("text-muted-foreground")};c.addEventListener("calendar-date-selected",D),x(),e._datePickerInitialized=!0,e._datePickerCleanup=()=>{c&&c.removeEventListener("calendar-date-selected",D)},m?e.setAttribute("data-with-time","true"):e.removeAttribute("data-with-time")}function T(e=document){e instanceof Element&&e.matches('[data-datepicker="true"]')&&y(e),e.querySelectorAll('[data-datepicker="true"]:not([data-initialized])').forEach(t=>{y(t)})}window.templUI=window.templUI||{},window.templUI.datePicker={init:T},document.addEventListener("DOMContentLoaded",()=>T())})();})();
