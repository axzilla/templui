(()=>{(function(){let v=!1;function L(f){let s=window.getComputedStyle(f);return s.display!=="none"&&s.visibility!=="hidden"&&s.opacity!=="0"}function N(f){if(!f||f.hasAttribute("data-initialized"))return;f.setAttribute("data-initialized","true");let s=f.querySelector("button.select-trigger");if(!s){console.error("Select box: Trigger button (.select-trigger) not found in wrapper",f);return}let g=s.getAttribute("data-tui-selectbox-content-id"),c=g?document.getElementById(g):null,n=s.querySelector(".select-value"),a=s.querySelector('input[type="hidden"]');if(!c||!n||!a){console.error("Select box: Missing required elements for initialization.",{wrapper:f,contentID:g,contentExists:!!c,valueElExists:!!n,hiddenInputExists:!!a});return}let k=s.getAttribute("data-tui-selectbox-multiple")==="true",A=s.getAttribute("data-tui-selectbox-show-pills")==="true",u=c.querySelector("[data-tui-selectbox-search]"),h=f.closest("form");document.removeEventListener("click",C),s.removeEventListener("keydown",S),s.removeEventListener("keydown",q),c.removeEventListener("keydown",I),c.removeEventListener("click",D),c.removeEventListener("keydown",M),c.removeEventListener("mouseover",P),c.removeEventListener("mouseleave",W),u&&u.removeEventListener("input",T),h&&h.removeEventListener("reset",B);function S(e){(e.key.length===1||e.key==="Backspace"||e.key==="Delete")&&(e.preventDefault(),document.getElementById(g).click(),setTimeout(()=>{u&&(u.focus(),e.key!=="Backspace"&&e.key!=="Delete"&&(u.value=e.key))},0))}function C(e){s.contains(e.target)&&setTimeout(()=>L(c)&&u.focus(),50)}function q(e){(e.key==="Enter"||e.key===" ")&&setTimeout(()=>L(c)&&u.focus(),50)}function T(e){let t=e.target.value.toLowerCase().trim();c.querySelectorAll(".select-item").forEach(l=>{let o=l.querySelector(".select-item-text")?.textContent.toLowerCase()||"",d=l.getAttribute("data-tui-selectbox-value")?.toLowerCase()||"",r=t===""||o.includes(t)||d.includes(t);l.style.display=r?"":"none"})}function I(e){if(e.key==="ArrowDown"||e.key==="ArrowUp"){e.preventDefault();let t=Array.from(c.querySelectorAll(".select-item")).filter(o=>o.style.display!=="none");if(t.length===0)return;let i=c.querySelector(".select-item:focus"),l=0;if(i){let o=t.indexOf(i);e.key==="ArrowDown"?l=(o+1)%t.length:l=(o-1+t.length)%t.length}t[l].focus()}else if(e.key==="Enter"){e.preventDefault();let t=c.querySelector(".select-item:focus");t&&y(t)}else e.key==="Escape"&&(e.preventDefault(),c.querySelector(".select-item:focus")?u.focus():document.activeElement===u&&window.closePopover&&(window.closePopover(g,!0),setTimeout(()=>{s.focus()},50)))}function D(e){let t=e.target.closest(".select-item");t&&y(t)}function M(e){let t=e.target.closest(".select-item");t&&(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),y(t))}function P(e){let t=e.target.closest(".select-item");!t||t.getAttribute("data-tui-selectbox-disabled")==="true"||(c.querySelectorAll(".select-item").forEach(i=>{i.classList.remove("bg-accent","text-accent-foreground","bg-muted")}),t.getAttribute("data-tui-selectbox-selected")!=="true"&&t.classList.add("bg-accent","text-accent-foreground"))}function W(){c.querySelectorAll(".select-item").forEach(e=>{e.getAttribute("data-tui-selectbox-selected")==="true"?(e.classList.add("bg-accent","text-accent-foreground"),e.classList.remove("bg-muted")):e.classList.remove("bg-accent","text-accent-foreground","bg-muted")})}function B(){c.querySelectorAll(".select-item").forEach(t=>{t.setAttribute("data-tui-selectbox-selected","false");let i=t.querySelector(".select-check");i&&i.classList.replace("opacity-100","opacity-0"),t.classList.remove("bg-accent","text-accent-foreground")});let e=n.getAttribute("data-placeholder")||s.querySelector(".select-value")?.getAttribute("data-placeholder")||"Select...";n.textContent=e,n.classList.add("text-muted-foreground"),a.value="",u&&(u.value="",c.querySelectorAll(".select-item").forEach(t=>{t.style.display=""}))}s.addEventListener("keydown",S),u&&(document.addEventListener("click",C),s.addEventListener("keydown",q),u.addEventListener("input",T)),c.addEventListener("keydown",I);let m=c.querySelectorAll('.select-item[data-tui-selectbox-selected="true"]');if(m.length>0)if(k){if(A){n.innerHTML="";let t=document.createElement("div");t.className="flex flex-nowrap overflow-hidden max-w-full whitespace-nowrap gap-1",Array.from(m).forEach(i=>{let l=document.createElement("div");l.className="flex items-center gap-1 px-2 py-1 text-xs rounded-md bg-primary text-primary-foreground";let o=document.createElement("span");o.textContent=i.querySelector(".select-item-text").textContent;let d=document.createElement("button");d.className="hover:text-destructive focus:outline-none",d.innerHTML="x",d.onclick=r=>{r.stopPropagation(),y(i)},l.appendChild(o),l.appendChild(d),t.appendChild(l)}),n.appendChild(t),n.classList.remove("text-muted-foreground"),setTimeout(()=>{let i=t.scrollWidth,l=n.clientWidth;if(i>l){let d=(s.getAttribute("data-tui-selectbox-selected-count-text")||`${m.length} items selected`).replace("{n}",m.length);n.innerHTML=d,n.classList.remove("text-muted-foreground")}},0)}else n.textContent=`${m.length} items selected`,n.classList.remove("text-muted-foreground");let e=Array.from(m).map(t=>t.getAttribute("data-tui-selectbox-value"));a.value=e.join(",")}else{let e=m[0],t=e.querySelector(".select-item-text");if(t&&(n.textContent=t.textContent,n.classList.remove("text-muted-foreground")),a){let i=e.getAttribute("data-tui-selectbox-value")||"";a.hasAttribute("data-initialized")||(a.value=i,a.setAttribute("data-initialized","true"),a.dispatchEvent(new Event("change",{bubbles:!0})))}}function y(e){if(!e||e.getAttribute("data-tui-selectbox-disabled")==="true"||v)return;v=!0;let t=e.getAttribute("data-tui-selectbox-value"),i=e.querySelector(".select-item-text");if(k){let l=e.getAttribute("data-tui-selectbox-selected")==="true";if(e.setAttribute("data-tui-selectbox-selected",(!l).toString()),l){e.classList.remove("bg-accent","text-accent-foreground");let r=e.querySelector(".select-check");r&&r.classList.replace("opacity-100","opacity-0")}else{e.classList.add("bg-accent","text-accent-foreground");let r=e.querySelector(".select-check");r&&r.classList.replace("opacity-0","opacity-100")}let o=c.querySelectorAll('.select-item[data-tui-selectbox-selected="true"]');if(o.length>0)if(A){n.innerHTML="";let r=document.createElement("div");r.className="flex flex-nowrap overflow-hidden max-w-full whitespace-nowrap gap-1",Array.from(o).forEach(b=>{let x=document.createElement("div");x.className="flex items-center gap-1 px-2 py-0.5 text-xs rounded-full bg-accent text-accent-foreground";let E=document.createElement("span");E.textContent=b.querySelector(".select-item-text").textContent;let p=document.createElement("button");p.className="hover:text-destructive focus:outline-none",p.innerHTML="\xD7",p.onclick=H=>{H.stopPropagation(),y(b)},x.appendChild(E),x.appendChild(p),r.appendChild(x)}),n.appendChild(r),n.classList.remove("text-muted-foreground"),setTimeout(()=>{let b=r.scrollWidth,x=n.clientWidth;if(b>x){let p=(s.getAttribute("data-tui-selectbox-selected-count-text")||`${o.length} items selected`).replace("{n}",o.length);n.innerHTML=p,n.classList.remove("text-muted-foreground")}},0)}else n.textContent=`${o.length} items selected`,n.classList.remove("text-muted-foreground");else n.textContent=n.getAttribute("data-tui-selectbox-placeholder")||"",n.classList.add("text-muted-foreground");let d=Array.from(o).map(r=>r.getAttribute("data-tui-selectbox-value"));a.value=d.join(","),a.dispatchEvent(new Event("change",{bubbles:!0}))}else{c.querySelectorAll(".select-item").forEach(o=>{o.setAttribute("data-tui-selectbox-selected","false"),o.classList.remove("bg-accent","text-accent-foreground","bg-muted");let d=o.querySelector(".select-check");d&&d.classList.replace("opacity-100","opacity-0")}),e.setAttribute("data-tui-selectbox-selected","true"),e.classList.add("bg-accent","text-accent-foreground");let l=e.querySelector(".select-check");if(l&&l.classList.replace("opacity-0","opacity-100"),n&&i&&(n.textContent=i.textContent,n.classList.remove("text-muted-foreground")),a&&t!==null){let o=a.value;a.value=t,o!==t&&a.dispatchEvent(new Event("change",{bubbles:!0}))}window.closePopover?(window.closePopover(g,!0),setTimeout(()=>{s.focus()},50)):console.warn("closePopover function not found")}setTimeout(()=>{v=!1},100)}c.addEventListener("click",D),c.addEventListener("keydown",M),c.addEventListener("mouseover",P),c.addEventListener("mouseleave",W),h&&h.addEventListener("reset",B)}function w(f=document){f.querySelectorAll(".select-container").forEach(N)}window.templUI=window.templUI||{},window.templUI.selectbox={init:w},document.addEventListener("DOMContentLoaded",()=>w())})();})();
