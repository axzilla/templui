(()=>{(function(){"use strict";let o=new WeakMap;class c{constructor(e,t={}){this.element=e,this.options={...c.defaults,...t},this.state={isSelecting:!1,selectedValues:new Set},this.listeners=new Map,this.init()}static defaults={multiple:!1,showPills:!1,searchable:!0,closeOnSelect:!0,selectedCountText:"{n} items selected"};init(){if(this.element.setAttribute("data-initialized","true"),this.triggerButton=this.element.querySelector("button.select-trigger"),!this.triggerButton){console.error("SelectBox: Trigger button not found",this.element);return}let e=this.triggerButton.dataset.contentId;if(this.content=e?document.getElementById(e):null,this.valueEl=this.triggerButton.querySelector(".select-value"),this.hiddenInput=this.triggerButton.querySelector('input[type="hidden"]'),!this.content||!this.valueEl||!this.hiddenInput){console.error("SelectBox: Missing required elements",{contentExists:!!this.content,valueElExists:!!this.valueEl,hiddenInputExists:!!this.hiddenInput});return}this.placeholder=this.valueEl.getAttribute("data-placeholder")||this.valueEl.textContent||"",this.valueEl.setAttribute("data-placeholder",this.placeholder),this.options.multiple=this.triggerButton.dataset.multiple==="true",this.options.showPills=this.triggerButton.dataset.showPills==="true",this.triggerButton.dataset.selectedCountText&&(this.options.selectedCountText=this.triggerButton.dataset.selectedCountText),this.initializeSelection(),this.setupEventHandlers(),this.setupResetFunctionality(),this.element.dispatchEvent(new CustomEvent("selectbox:init",{detail:{instance:this},bubbles:!0}))}initializeSelection(){let e=this.content.querySelectorAll('.select-item[data-selected="true"]');e.forEach(t=>{let s=t.getAttribute("data-value");s&&this.state.selectedValues.add(s)}),e.length>0&&(this.updateDisplay(),this.updateHiddenInput())}setupEventHandlers(){this.addEventListener(this.triggerButton,"keydown",s=>{(s.key.length===1||s.key==="Backspace"||s.key==="Delete")&&(s.preventDefault(),this.content.click(),setTimeout(()=>{let i=this.content.querySelector("[data-select-search]");i&&(i.focus(),s.key!=="Backspace"&&s.key!=="Delete"&&(i.value=s.key))},0))});let e=this.content.querySelector("[data-select-search]");e&&this.setupSearch(e),this.addEventListener(this.content,"keydown",s=>this.handleContentKeydown(s));let t=s=>{if(!this.content.contains(s.target))return;let i=s.target.closest(".select-item");i&&i.getAttribute("data-disabled")!=="true"&&this.selectItem(i)};document.addEventListener("click",t),this.itemClickHandler=t,this.addEventListener(this.content,"mouseover",s=>{let i=s.target.closest(".select-item");i&&i.getAttribute("data-disabled")!=="true"&&this.highlightItem(i)}),this.addEventListener(this.content,"mouseleave",()=>{this.resetItemStyles()})}setupSearch(e){new MutationObserver(()=>{let s=window.getComputedStyle(this.content);s.display!=="none"&&s.visibility!=="hidden"&&s.opacity!=="0"&&e.focus()}).observe(this.content,{attributes:!0,attributeFilter:["style","class"]}),this.addEventListener(e,"input",s=>{let i=s.target.value.toLowerCase().trim();this.content.querySelectorAll(".select-item").forEach(a=>{let r=a.querySelector(".select-item-text")?.textContent.toLowerCase()||"",u=a.getAttribute("data-value")?.toLowerCase()||"",d=i===""||r.includes(i)||u.includes(i);a.style.display=d?"":"none"})})}setupResetFunctionality(){(this.element.hasAttribute("data-show-reset")||this.triggerButton.hasAttribute("data-show-reset"))&&this.addInternalResetButton(),this.externalResetHandler=t=>{let s=t.target.closest("[data-selectbox-reset]");if(s){let i=s.getAttribute("data-selectbox-reset");i&&(this.element.matches(i)||this.element.id===i.replace("#",""))&&(t.preventDefault(),this.reset())}},document.addEventListener("click",this.externalResetHandler)}addInternalResetButton(){let e=document.createElement("span");e.className="select-reset-container ml-1",e.style.display="none";let t=document.createElement("button");t.type="button",t.className="select-reset-button p-1 hover:text-destructive transition-colors",t.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>',t.setAttribute("aria-label","Clear selection"),e.appendChild(t);let s=this.triggerButton.querySelector(".pointer-events-none");s&&s.parentNode.insertBefore(e,s),this.addEventListener(t,"click",i=>{i.stopPropagation(),this.reset()}),this.resetContainer=e,this.updateResetButtonVisibility()}updateResetButtonVisibility(){if(this.resetContainer){let e=this.state.selectedValues.size>0;this.resetContainer.style.display=e?"":"none"}}handleContentKeydown(e){if(e.key==="ArrowDown"||e.key==="ArrowUp"){e.preventDefault();let t=Array.from(this.content.querySelectorAll(".select-item")).filter(l=>l.style.display!=="none");if(t.length===0)return;let s=this.content.querySelector(".select-item:focus"),i=0;if(s){let l=t.indexOf(s);e.key==="ArrowDown"?i=(l+1)%t.length:i=(l-1+t.length)%t.length}t[i].focus()}else if(e.key==="Enter"){e.preventDefault();let t=this.content.querySelector(".select-item:focus");t&&this.selectItem(t)}else if(e.key==="Escape"){e.preventDefault();let t=this.content.querySelector("[data-select-search]");this.content.querySelector(".select-item:focus")&&t?t.focus():document.activeElement===t&&window.closePopover&&(window.closePopover(this.content.id,!0),setTimeout(()=>this.triggerButton.focus(),50))}}selectItem(e){if(this.state.isSelecting)return;this.state.isSelecting=!0;let t=e.getAttribute("data-value"),s=new Set(this.state.selectedValues);this.options.multiple?this.state.selectedValues.has(t)?(this.state.selectedValues.delete(t),e.setAttribute("data-selected","false"),this.updateItemVisual(e,!1)):(this.state.selectedValues.add(t),e.setAttribute("data-selected","true"),this.updateItemVisual(e,!0)):(this.content.querySelectorAll(".select-item").forEach(i=>{i.setAttribute("data-selected","false"),this.updateItemVisual(i,!1)}),this.state.selectedValues.clear(),this.state.selectedValues.add(t),e.setAttribute("data-selected","true"),this.updateItemVisual(e,!0),this.options.closeOnSelect&&window.closePopover&&(window.closePopover(this.content.id,!0),setTimeout(()=>this.triggerButton.focus(),50))),this.updateDisplay(),this.updateHiddenInput(),this.updateResetButtonVisibility(),this.element.dispatchEvent(new CustomEvent("selectbox:change",{detail:{value:this.getValue(),previousValue:Array.from(s),item:e},bubbles:!0})),setTimeout(()=>{this.state.isSelecting=!1},100)}updateItemVisual(e,t){let s=e.querySelector(".select-check");t?(e.classList.add("bg-accent","text-accent-foreground"),s&&s.classList.replace("opacity-0","opacity-100")):(e.classList.remove("bg-accent","text-accent-foreground"),s&&s.classList.replace("opacity-100","opacity-0"))}highlightItem(e){this.content.querySelectorAll(".select-item").forEach(t=>{t!==e&&t.classList.remove("bg-accent","text-accent-foreground","bg-muted")}),e.getAttribute("data-selected")!=="true"&&e.classList.add("bg-accent","text-accent-foreground")}resetItemStyles(){this.content.querySelectorAll(".select-item").forEach(e=>{e.getAttribute("data-selected")==="true"?(e.classList.add("bg-accent","text-accent-foreground"),e.classList.remove("bg-muted")):e.classList.remove("bg-accent","text-accent-foreground","bg-muted")})}updateDisplay(){let e=Array.from(this.content.querySelectorAll('.select-item[data-selected="true"]'));if(e.length===0){this.valueEl.textContent=this.placeholder,this.valueEl.classList.add("text-muted-foreground");return}if(this.valueEl.classList.remove("text-muted-foreground"),this.options.multiple)if(this.options.showPills)this.renderPills(e);else{let t=this.options.selectedCountText.replace("{n}",e.length);this.valueEl.textContent=t}else{let s=e[0].querySelector(".select-item-text");s&&(this.valueEl.textContent=s.textContent)}}renderPills(e){this.valueEl.innerHTML="";let t=document.createElement("div");t.className="flex flex-nowrap overflow-hidden max-w-full whitespace-nowrap gap-1",e.forEach(s=>{let i=document.createElement("div");i.className="flex items-center gap-1 px-2 py-0.5 text-xs rounded-full bg-accent text-accent-foreground";let l=document.createElement("span");l.textContent=s.querySelector(".select-item-text").textContent;let a=document.createElement("button");a.type="button",a.className="hover:text-destructive focus:outline-none",a.innerHTML="\xD7",a.onclick=r=>{r.stopPropagation(),this.selectItem(s)},i.appendChild(l),i.appendChild(a),t.appendChild(i)}),this.valueEl.appendChild(t),setTimeout(()=>{let s=t.scrollWidth,i=this.valueEl.clientWidth;if(s>i){let l=this.options.selectedCountText.replace("{n}",e.length);this.valueEl.textContent=l}},0)}updateHiddenInput(){let e=Array.from(this.state.selectedValues),t=this.hiddenInput.value,s=e.join(",");this.hiddenInput.value=s,t!==s&&this.hiddenInput.dispatchEvent(new Event("change",{bubbles:!0}))}getValue(){return this.options.multiple?Array.from(this.state.selectedValues):this.state.selectedValues.size>0?Array.from(this.state.selectedValues)[0]:null}setValue(e){let t=new Set(this.state.selectedValues);this.state.selectedValues.clear(),this.content.querySelectorAll(".select-item").forEach(i=>{i.setAttribute("data-selected","false"),this.updateItemVisual(i,!1)}),(Array.isArray(e)?e:[e]).forEach(i=>{if(i!=null){let l=this.content.querySelector(`.select-item[data-value="${i}"]`);l&&(this.state.selectedValues.add(i),l.setAttribute("data-selected","true"),this.updateItemVisual(l,!0))}}),this.updateDisplay(),this.updateHiddenInput(),this.updateResetButtonVisibility(),this.element.dispatchEvent(new CustomEvent("selectbox:change",{detail:{value:this.getValue(),previousValue:Array.from(t)},bubbles:!0}))}reset(){let e=new Set(this.state.selectedValues);this.state.selectedValues.clear(),this.content.querySelectorAll(".select-item").forEach(s=>{s.setAttribute("data-selected","false"),this.updateItemVisual(s,!1)}),this.valueEl.textContent=this.placeholder,this.valueEl.classList.add("text-muted-foreground"),this.hiddenInput.value="",this.hiddenInput.dispatchEvent(new Event("change",{bubbles:!0})),this.updateResetButtonVisibility();let t=this.content.querySelector("[data-select-search]");t&&(t.value="",t.dispatchEvent(new Event("input",{bubbles:!0}))),this.element.dispatchEvent(new CustomEvent("selectbox:reset",{detail:{previousValue:Array.from(e)},bubbles:!0}))}enable(){this.triggerButton.disabled=!1,this.element.classList.remove("opacity-50")}disable(){this.triggerButton.disabled=!0,this.element.classList.add("opacity-50")}destroy(){this.listeners.forEach((e,t)=>{t.element.removeEventListener(t.event,e)}),this.listeners.clear(),this.itemClickHandler&&document.removeEventListener("click",this.itemClickHandler),this.externalResetHandler&&document.removeEventListener("click",this.externalResetHandler),this.element.removeAttribute("data-initialized"),o.delete(this.element),this.element.dispatchEvent(new CustomEvent("selectbox:destroy",{detail:{instance:this},bubbles:!0}))}addEventListener(e,t,s){e.addEventListener(t,s);let i={element:e,event:t};this.listeners.set(i,s)}}window.templUI=window.templUI||{},window.templUI.selectbox={getInstance(n){let e=typeof n=="string"?document.querySelector(n):n;return e?o.get(e):null},init(n=".select-container"){(typeof n=="string"?document.querySelectorAll(n):[n]).forEach(t=>{o.has(t)||o.set(t,new c(t))})},destroy(n){n?this.getInstance(n)?.destroy():o.forEach(e=>e.destroy())},getValue(n){return this.getInstance(n)?.getValue()},setValue(n,e){return this.getInstance(n)?.setValue(e)},reset(n){return this.getInstance(n)?.reset()},enable(n){return this.getInstance(n)?.enable()},disable(n){return this.getInstance(n)?.disable()}},document.addEventListener("DOMContentLoaded",()=>{window.templUI.selectbox.init()})})();})();
