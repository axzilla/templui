(()=>{typeof window.inputOTPState>"u"&&(window.inputOTPState=new WeakMap);(function(){if(window.inputOTPSystemInitialized)return;function p(i){if(window.inputOTPState.has(i))return;let a=i.querySelector("[data-input-otp-value-target]"),n=Array.from(i.querySelectorAll("[data-input-otp-slot]")).sort((t,e)=>parseInt(t.dataset.inputIndex)-parseInt(e.dataset.inputIndex));if(!a||n.length===0)return;i.hasAttribute("autofocus")&&requestAnimationFrame(()=>{let t=n[0];t&&(t.focus(),t.select())});let o=()=>{a.value=n.map(t=>t.value).join("")},m=()=>n.findIndex(t=>!t.value),u=t=>{t>=0&&t<n.length&&(n[t].focus(),setTimeout(()=>n[t].select(),0))},h=t=>{let e=t.target,s=parseInt(e.dataset.inputIndex);if(e.value===" "){e.value="";return}e.value.length>1&&(e.value=e.value.slice(-1)),e.value&&s<n.length-1&&u(s+1),o()},w=t=>{let e=t.target,s=parseInt(e.dataset.inputIndex);if(t.key==="Backspace"){let l=e.value;s>0&&(t.preventDefault(),l?(e.value="",o(),u(s-1)):(n[s-1].value="",o(),u(s-1)))}else t.key==="ArrowLeft"&&s>0?(t.preventDefault(),u(s-1)):t.key==="ArrowRight"&&s<n.length-1&&(t.preventDefault(),u(s+1))},I=t=>{let e=t.target,s=parseInt(e.dataset.inputIndex),l=m();if(l!==-1&&s!==l){u(l);return}setTimeout(()=>e.select(),0)},g=t=>{t.preventDefault();let s=(t.clipboardData||window.clipboardData).getData("text").replace(/\s/g,"").split(""),l=0,S=n.find(r=>r===document.activeElement);S&&(l=parseInt(S.dataset.inputIndex));for(let r=0;r<s.length&&l<n.length;r++)n[l].value=s[r],l++;o();let d=m();d===-1?d=n.length-1:d>0&&d>l&&(d=l),u(Math.min(d,n.length-1))};for(let t of n)t.addEventListener("input",h),t.addEventListener("keydown",w),t.addEventListener("focus",I);i.addEventListener("paste",g);let L=a.id;if(L){for(let t of document.querySelectorAll(`label[for="${L}"]`))if(!t.dataset.inputOtpListener){let e=s=>{s.preventDefault(),n.length>0&&u(0)};t.addEventListener("click",e),t.dataset.inputOtpListener="true",t._inputOtpClickListener=e}}if(i.dataset.value){let t=i.dataset.value;for(let e=0;e<n.length&&e<t.length;e++)n[e].value=t[e];o()}let y={slots:n,hiddenInput:a,handleInput:h,handleKeydown:w,handleFocus:I,handlePaste:g};window.inputOTPState.set(i,y)}function f(i){let a=window.inputOTPState.get(i);if(!a)return;for(let o of a.slots)o.removeEventListener("input",a.handleInput),o.removeEventListener("keydown",a.handleKeydown),o.removeEventListener("focus",a.handleFocus);i.removeEventListener("paste",a.handlePaste);let n=a.hiddenInput.id;if(n)for(let o of document.querySelectorAll(`label[for="${n}"]`))o._inputOtpClickListener&&(o.removeEventListener("click",o._inputOtpClickListener),delete o._inputOtpClickListener,delete o.dataset.inputOtpListener);window.inputOTPState.delete(i)}function c(i=document){i instanceof Element&&i.matches("[data-input-otp]")&&p(i),i.querySelectorAll("[data-input-otp]").forEach(p)}let v=i=>{let a=i.detail.elt;a instanceof Element&&requestAnimationFrame(()=>c(a))};document.addEventListener("DOMContentLoaded",()=>c()),document.body.addEventListener("htmx:beforeSwap",i=>{let a=i.detail.elt;if(a instanceof Element&&(a.matches&&a.matches("[data-input-otp]")&&f(a),a.querySelectorAll))for(let n of a.querySelectorAll("[data-input-otp]"))f(n)}),c(),document.body.addEventListener("htmx:afterSwap",v),document.body.addEventListener("htmx:oobAfterSwap",v),window.inputOTPSystemInitialized=!0})();})();
